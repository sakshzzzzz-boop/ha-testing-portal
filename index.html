<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HA Testing Portal - Issue Tracker</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f6f0e8;
        padding: 20px;
    }

    .header-container {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        margin-bottom: 15px;
    }
    .company-logo {
        width: 95px;
        height: 65px;
        position: absolute;
        left: 0;
    }
    .header-title {
        text-align: center;
    }

    .form-container {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        margin: auto;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    table, th, td {
        border: 2px solid #aaa;
    }
    th {
        background: #e2b699;
        padding: 8px;
        text-align: left;
        font-weight: bold;
    }
    td {
        padding: 8px;
    }
    input, select, textarea {
        width: 100%;
        padding: 5px;
        margin: 5px 0;
    }
    button {
        padding: 10px 20px;
        background: #c97b4e;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }
    button:hover {
        background: #a5623d;
    }

    .export-btn {
        padding: 10px 20px;
        background: #c97b4e;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        margin-top: 10px;
    }
</style>
</head>

<body>

<div class="header-container">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmPGnW5jbebWn1jpXVQiY75J9wcVBA74jHbQ&s" class="company-logo">
    <div class="header-title">
        <h2>HA TESTING PORTAL</h2>
        <h3>ISSUE TRACKER</h3>
    </div>
</div>

<div class="form-container">
<h3>Add New Issue</h3>

<form id="issueForm">
    <label>Issue Description:</label>
    <textarea id="description" required></textarea>

    <label>Module:</label>
    <input type="text" id="module" required>

    <label>Department:</label>
    <input type="text" id="department" required>

    <label>Issue Raised By:</label>
    <input type="text" id="raisedBy" required>

    <label>Date:</label>
    <input type="date" id="date" required>

    <label>Status:</label>
    <select id="status">
        <option>Open</option>
        <option>In Progress</option>
        <option>Closed</option>
    </select>

    <label>Priority:</label>
    <select id="priority">
        <option>Low</option>
        <option>Medium</option>
        <option>High</option>
    </select>

    <label>Remarks:</label>
    <input type="text" id="remarks">

    <button type="button" onclick="addIssue()">Add Issue</button>
</form>
</div>

<table id="issueTable">
<thead>
<tr>
    <th>SL NO.</th>
    <th>Issue / Description</th>
    <th>Module</th>
    <th>Department</th>
    <th>Issue Raised By</th>
    <th>Date</th>
    <th>Status</th>
    <th>Priority</th>
    <th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="exportToExcel()" class="export-btn">Export to Excel</button>

<!-- FIREBASE + APP LOGIC -->
<script type="module">

/* --------------------- FIREBASE SETUP --------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyArTVcAzatZiXhY4QtkdUV6xtZxbbwJWqw",
    authDomain: "ha-testing-portal.firebaseapp.com",
    databaseURL: "https://ha-testing-portal-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "ha-testing-portal",
    storageBucket: "ha-testing-portal.firebasestorage.app",
    messagingSenderId: "210094909594",
    appId: "1:210094909594:web:8c4885abb5dce21a4b5723",
    measurementId: "G-H6S46PTHSB"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const issuesRef = ref(db, "issues");


/* --------------------- ADD ISSUE --------------------- */
window.addIssue = function () {

const issue = {
    description: document.getElementById("description").value,
    module: document.getElementById("module").value,
    department: document.getElementById("department").value,
    raisedBy: document.getElementById("raisedBy").value,
    date: document.getElementById("date").value,
    status: document.getElementById("status").value,
    priority: document.getElementById("priority").value,
    remarks: document.getElementById("remarks").value
};


    if (!issue.description || !issue.module || !issue.department || !issue.raisedBy || !issue.date) {
        alert("Please fill all required fields.");
        return;
    }

    push(issuesRef, issue);

    document.getElementById("issueForm").reset();
};


/* --------------------- LOAD ISSUES LIVE --------------------- */
onValue(issuesRef, snapshot => {
    const tableBody = document.querySelector("#issueTable tbody");
    tableBody.innerHTML = "";

    let sl = 1;

    snapshot.forEach(child => {
        let issue = child.val();
        let key = child.key;

        let row = document.createElement("tr");
        row.innerHTML = `
            <td>${sl++}</td>
            <td>${issue.description}</td>
            <td>${issue.module}</td>
            <td>${issue.department}</td>
            <td>${issue.raisedBy}</td>
            <td>${issue.date}</td>

            <td>
                <select class="statusSelect">
                    <option ${issue.status === "Open" ? "selected" : ""}>Open</option>
                    <option ${issue.status === "In Progress" ? "selected" : ""}>In Progress</option>
                    <option ${issue.status === "Closed" ? "selected" : ""}>Closed</option>
                </select>
            </td>

            <td>
                <select class="prioritySelect">
                    <option ${issue.priority === "Low" ? "selected" : ""}>Low</option>
                    <option ${issue.priority === "Medium" ? "selected" : ""}>Medium</option>
                    <option ${issue.priority === "High" ? "selected" : ""}>High</option>
                </select>
            </td>

            <td>${issue.remarks}</td>
        `;

        // Update status
        row.querySelector(".statusSelect").addEventListener("change", function () {
            update(ref(db, "issues/" + key), { status: this.value });
        });

        // Update priority
        row.querySelector(".prioritySelect").addEventListener("change", function () {
            update(ref(db, "issues/" + key), { priority: this.value });
        });

        tableBody.appendChild(row);
    });
});


/* --------------------- EXPORT TO EXCEL --------------------- */
window.exportToExcel = function () {
    const table = document.getElementById("issueTable").outerHTML;
    const file = new Blob([table], { type: "application/vnd.ms-excel" });
    const url = URL.createObjectURL(file);

    const a = document.createElement("a");
    a.href = url;
    a.download = "Issue_Tracker.xls";
    a.click();
};

</script>

</body>
</html>
