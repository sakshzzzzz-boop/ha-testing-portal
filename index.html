<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HA Testing Portal - Issue Tracker</title>

<style>
    body { font-family: Arial; background: #f6f0e8; padding:20px; }
    .form-container { background:#fff; padding:20px; border-radius:8px; width:80%; margin:auto; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:2px solid #aaa; }
    th { background:#e2b699; padding:8px; }
    td { padding:8px; }
    input, select, textarea { width:100%; padding:5px; margin:5px 0; }
    button { padding:10px 20px; background:#c97b4e; color:white; border:none; }
</style>
</head>

<body>

<h2 style="text-align:center">HA TESTING PORTAL â€“ ISSUE TRACKER</h2>

<div class="form-container">
<h3>Add New Issue</h3>

<form id="issueForm">
    <label>Issue Description:</label>
    <textarea id="description" required></textarea>

    <label>Module:</label>
    <input type="text" id="module" required>

    <label>Department:</label>
    <input type="text" id="department" required>

    <label>Issue Raised By:</label>
    <input type="text" id="raisedBy" required>

    <label>Date:</label>
    <input type="date" id="date" required>

    <label>Status:</label>
    <select id="status">
        <option>Open</option>
        <option>In Progress</option>
        <option>Closed</option>
    </select>

    <label>Priority:</label>
    <select id="priority">
        <option>Low</option>
        <option>Medium</option>
        <option>High</option>
    </select>

    <label>Remarks:</label>
    <input type="text" id="remarks">

    <button type="button" onclick="addIssue()">Add Issue</button>
</form>
</div>

<table id="issueTable">
<thead>
<tr>
    <th>SL NO</th>
    <th>Description</th>
    <th>Module</th>
    <th>Department</th>
    <th>Raised By</th>
    <th>Date</th>
    <th>Status</th>
    <th>Priority</th>
    <th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script type="module">

// ----------------- FIREBASE IMPORTS -------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update } 
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";

// ----------------- FIREBASE CONFIG --------------------
const firebaseConfig = {
    apiKey: "AIzaSyArTVcAzatZiXhY4QtkdUV6xtZxbbwJWqw",
    authDomain: "ha-testing-portal.firebaseapp.com",
    databaseURL: "https://ha-testing-portal-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "ha-testing-portal",
    storageBucket: "ha-testing-portal.firebasestorage.app",
    messagingSenderId: "210094909594",
    appId: "1:210094909594:web:8c4885abb5dce21a4b5723"
};

// ----------------- INIT FIREBASE ----------------------
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const issuesRef = ref(db, "issues");

// ----------------- ADD ISSUE --------------------------
function addIssue() {
    let issue = {
        description: description.value,
        module: module.value,
        department: department.value,
        raisedBy: raisedBy.value,
        date: date.value,
        status: status.value,
        priority: priority.value,
        remarks: remarks.value
    };

    push(issuesRef, issue);
    document.getElementById("issueForm").reset();
}

// ----------------- LOAD ISSUES ------------------------
onValue(issuesRef, (snapshot) => {
    const tableBody = document.querySelector("#issueTable tbody");
    tableBody.innerHTML = "";
    let slno = 1;

    snapshot.forEach(child => {
        const id = child.key;
        const issue = child.val();

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${slno++}</td>
            <td>${issue.description}</td>
            <td>${issue.module}</td>
            <td>${issue.department}</td>
            <td>${issue.raisedBy}</td>
            <td>${issue.date}</td>

            <td>
                <select class="status">
                    <option ${issue.status=="Open"?"selected":""}>Open</option>
                    <option ${issue.status=="In Progress"?"selected":""}>In Progress</option>
                    <option ${issue.status=="Closed"?"selected":""}>Closed</option>
                </select>
            </td>

            <td>
                <select class="priority">
                    <option ${issue.priority=="Low"?"selected":""}>Low</option>
                    <option ${issue.priority=="Medium"?"selected":""}>Medium</option>
                    <option ${issue.priority=="High"?"selected":""}>High</option>
                </select>
            </td>

            <td>${issue.remarks}</td>
        `;

        // UPDATE STATUS
        row.querySelector(".status").addEventListener("change", e => {
            update(ref(db, "issues/" + id), { status: e.target.value });
        });

        // UPDATE PRIORITY
        row.querySelector(".priority").addEventListener("change", e => {
            update(ref(db, "issues/" + id), { priority: e.target.value });
        });

        tableBody.appendChild(row);
    });
});
</script>

</body>
</html>
